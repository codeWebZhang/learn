<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      //
      zzzz = 'zhang';
      const global = this;
      (function () {
        let outterVariable = 'outter';
        const createSandbox = () => {
          const context = Object.create(global);
          // const context = {};
          const proxy = new Proxy(context, {
            set: (obj, prop, value) => {
              // console.log(prop);
              obj[prop] = value;
            },
            get: (obj, prop) => {
              if (prop in obj) return obj[prop];
              return undefined;
            },
            has: (obj, prop) => {
              return true;
            },
          });
          return (code) => {
            Function(
              'proxy',
              `
                  with(proxy) {
                      ;${code};
                  }
              `
            )(proxy);
          };
        };
        const sandbox = createSandbox();
        sandbox(`
          var a = 1;
          var b = 2;
          // 期待打出 1 2
          console.log(a, b);
          outterVariable = 'sandbox';
          console.log(zzzz,'zzzz')
          console.log(outterVariable);
      `);
        try {
          console.log(a, 'fail');
        } catch (e) {
          console.log('success');
        }
        try {
          console.log(b, 'fail');
        } catch (b) {
          console.log('success');
        }
        console.log(outterVariable);

        console.log(window.zzzz, 'zzzz');
      })();
      // console.log(outterVariable);

      //返回所有叠字
      function unique(str) {
        var arr = str.split('');
        let start = '';
        let result = [];
        for (let i = 0; i < arr.length; i++) {
          if (arr[i] == arr[i + 1]) {
            start += arr[i + 1];
          } else {
            if (start.length > 0) {
              start += arr[i];
              result.push(start);
            }
            start = '';
          }
        }
        return result;
      }

      var str = 'aafaafsdffvvdgggg';
      console.log(unique(str));

      let o = {
        num: 1,
        obj: {
          age: 88,
        },
        arr: [1, 3, 4],
        o: {
          arr: [88, 99],
        },
      };
      function deepClone(obj) {
        let result =
          Object.prototype.toString.call(obj) == '[object Object]' ? {} : [];
        for (let i in obj) {
          if (typeof obj[i] == 'object') {
            result[i] = deepClone(obj[i]);
          } else {
            result[i] = obj[i];
          }
        }
        return result;
      }
      let c = deepClone(o);
      console.log(c == o, '深度克隆', c);
    </script>
  </body>
</html>
