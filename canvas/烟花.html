<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <canvas id="myCanvas"></canvas>
    <script>
      var canvas = document.getElementById('myCanvas');
      var context = canvas.getContext('2d');

      function resizeCanvas() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }

      function clearCanvas() {
        context.fillStyle = '#ffffff';
        context.fillRect(0, 0, canvas.width, canvas.height);
      }

      resizeCanvas();

      function mouseDownHandler(e) {
        var x = e.clientX;
        var y = e.clientY;
        // drawFireworks(x, y);
        fire(x, y);
      }

      function drawFireworks(sx, sy, radius) {
        clearCanvas();
        var count = 10; //烟花粒子数量
        // var radius = 10; //烟花环绕半径
        for (var i = 0; i < count; i++) {
          var angle = (360 / count) * i; //烟花粒子角度
          var radians = (angle * Math.PI) / 180; //烟花粒子弧度

          var vx = sx + Math.cos(radians) * radius;
          var vy = sy + Math.sin(radians) * radius;

          var size = 2;
          context.beginPath();
          context.arc(vx, vy, size, 0, Math.PI * 2, false);
          context.closePath();
          context.fillStyle = '#ff0000';
          context.fill();
          // debugger;
        }
      }

      // var radius = 0; //圆心半径
      function fire(x, y) {
        var radius = 0;
        function tick() {
          drawFireworks(x, y, radius); //绘制烟花
          radius++; //半径不断变大
        }
        setInterval(tick, 30); //每30毫秒绘制一次
      }

      var rid;
      function fire(x, y) {
        createFireworks(x, y);

        function tick() {
          // drawFireworks();
          // rid = requestAnimationFrame(tick);
          //tips:注意新加入的这4行代码
          // context.globalCompositeOperation = 'destination-over';
          context.fillStyle = 'rgba(0,0,0,' + 10 / 100 + ')';
          context.fillRect(0, 0, canvas.width, canvas.height);
          // context.globalCompositeOperation = 'lighter';
          //tipsend
          drawFireworks();
          rid = requestAnimationFrame(tick);
        }
        cancelAnimationFrame(rid);
        tick();
      }

      var particles = [];
      function createFireworks(sx, sy) {
        particles = [];

        var hue = Math.floor(Math.random() * 51) + 150;
        var hueVariance = 30;
        var count = 100;

        for (var i = 0; i < count; i++) {
          var p = {};

          var angle = Math.floor(Math.random() * 360);
          p.radians = (angle * Math.PI) / 180;
          p.radius = 0;

          p.sx = sx;
          p.sy = sy;

          p.speed = Math.random() * 5 + 0.4;

          p.size = Math.floor(Math.random() * 3) + 1;

          p.hue =
            Math.floor(
              Math.random() * (hue + hueVariance - (hue - hueVariance))
            ) +
            (hue - hueVariance);
          p.brightness = Math.floor(Math.random() * 31) + 50;
          p.alpha = (Math.floor(Math.random() * 61) + 40) / 100;

          var vx = Math.cos(p.radians) * p.radius;
          var vy = Math.sin(p.radians) * p.radius + 0.4;

          p.x += vx;
          p.y += vy;

          p.radius *= 1 - p.speed / 100;

          p.alpha -= 0.005;

          particles.push(p);
        }
      }

      function drawFireworks() {
        clearCanvas();

        for (var i = 0; i < particles.length; i++) {
          var p = particles[i];

          p.vx = p.sx + Math.cos(p.radians) * p.radius;
          p.vy = p.sy + Math.sin(p.radians) * p.radius;

          p.radius += 1 + p.speed;

          context.beginPath();
          context.arc(p.vx, p.vy, p.size, 0, Math.PI * 2, false);
          context.closePath();

          context.fillStyle =
            'hsla(' + p.hue + ', 100%, ' + p.brightness + '%, ' + 100 + ')';
          context.fill();
        }
      }

      window.addEventListener('resize', resizeCanvas, false);
      window.addEventListener('mousedown', mouseDownHandler, false);
    </script>
  </body>
</html>
